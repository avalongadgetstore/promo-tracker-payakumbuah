<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diviss Report System</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
</head>
<body>
  <!-- STICKY TOP BAR -->
  <header class="topbar">
    <div class="logo">Diviss Report System</div>
    <div class="topbar-right">
      <span id="userRole" class="pill"></span>
      <span id="usernameDisplay" class="username"></span>
      <button id="googleConnectBtn" class="btn" onclick="connectGoogle()">Connect Google</button>
      <button id="logoutBtn" class="btn btn-ghost" onclick="logout()">Logout</button>
    </div>
  </header>

  <!-- LAYOUT: SIDEBAR + MAIN -->
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-top">Menu</div>
      <ul class="menu">
        <li class="menu-item" onclick="showPage('homePage')">ğŸ  Home</li>
        <li class="menu-item" onclick="showPage('promoPage')">ğŸ« Promo</li>
        <li class="menu-item" onclick="showPage('transactionPage')">ğŸ“ Input Promo</li>
        <li class="menu-item" onclick="showPage('exportPage')">ğŸ“¤ Export Laporan</li>
        <li class="menu-item" onclick="showPage('leaderboardPage')">ğŸ† Leaderboard</li>
        <li class="menu-item" onclick="showPage('managePage')">âš™ï¸ Manage Promo</li>
      </ul>
      <div class="sidebar-bottom">v1.0</div>
    </aside>

    <main class="main-content">
      <!-- HOME -->
      <section id="homePage" class="page active">
        <h1>Welcome to Diviss Report System</h1>
        <p class="lead">Kelola promo, catat transaksi, dan ekspor laporan dengan mudah.</p>

        <div class="grid">
          <div class="card big" onclick="selectCaptain()">
            <h3>Login as Captain</h3>
            <p>Full access: export laporan, manage promo, pembagian kuota.</p>
          </div>
          <div class="card big" onclick="selectServer()">
            <h3>Login as Server</h3>
            <p>Input transaksi, upload foto pelanggan.</p>
          </div>
        </div>
      </section>

      <!-- PROMO LIST -->
      <section id="promoPage" class="page">
        <h2>Daftar Promo Aktif</h2>
        <div id="promoList" class="grid"></div>
      </section>

      <!-- INPUT TRANSAKSI -->
      <section id="transactionPage" class="page">
        <h2>Input Transaksi Promo</h2>
        <div class="card form">
          <label>Nama Server</label>
          <select id="serverName">
            <option value="">-- pilih nama --</option>
            <option value="Kusmiyati">ğŸ‘© Kusmiyati</option>
            <option value="Reikhan">ğŸ‘¨ Reikhan</option>
            <option value="Ziah">ğŸ‘© Ziah</option>
            <option value="Asty">ğŸ‘© Asty</option>
            <option value="Ronal">ğŸ‘¨ Ronal</option>
            <option value="Deden">ğŸ‘¨ Deden</option>
          </select>

          <label>Jenis Promo</label>
          <select id="promoSelect"></select>

          <label>Nama Customer</label>
          <input id="customerName" placeholder="Nama customer" />

          <label>No. HP Customer</label>
          <input id="customerPhone" placeholder="08xxxx" />

          <label>Upload Foto (kamera)</label>
          <input id="promoPhoto" type="file" accept="image/*" capture="environment" />

          <div class="form-actions">
            <button class="btn-primary" onclick="submitPromo()">Submit</button>
          </div>
        </div>
      </section>

      <!-- EXPORT -->
      <section id="exportPage" class="page">
        <h2>Export Laporan</h2>
        <div class="card">
          <label>Pilih promo (bisa multi-select):</label>
          <div id="promoCheckboxList" class="checkbox-list"></div>

          <label>Rentang tanggal:</label>
          <div class="row">
            <input type="date" id="dateFrom" />
            <input type="date" id="dateTo" />
          </div>

          <div class="form-actions">
            <button class="btn-primary" onclick="exportSelectedPromos()">Export ke Google Sheets</button>
          </div>
        </div>
        <div id="exportStatus" class="muted"></div>
      </section>

      <!-- LEADERBOARD -->
      <section id="leaderboardPage" class="page">
        <h2>Leaderboard</h2>
        <div id="leaderboardList" class="card"></div>
      </section>

      <!-- MANAGE -->
      <section id="managePage" class="page">
        <h2>Manage Promo (Captain)</h2>
        <div class="card">
          <label>Nama Promo</label>
          <input id="newPromoName" placeholder="Nama promo" />
          <label>Deskripsi</label>
          <input id="newPromoDesc" placeholder="Deskripsi singkat" />
          <label>Periode mulai</label>
          <input id="newPromoStart" type="date" />
          <label>Periode selesai</label>
          <input id="newPromoEnd" type="date" />
          <label>Kuota</label>
          <input id="newPromoQuota" type="number" />
          <div class="form-actions">
            <button class="btn-primary" onclick="addPromo()">Tambah Promo</button>
          </div>
        </div>
        <div id="manageList"></div>
      </section>

    </main>
  </div>

  <!-- SCRIPTS -->
  <script src="supabase.js"></script>
  <script src="google-auth.js"></script>
  <script src="google-sheets.js"></script>
  <script src="google-drive.js"></script>
  <script src="app.js"></script>
</body>
</html>
